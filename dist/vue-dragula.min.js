/*!
 * vue-dragula v2.3.0
 * (c) 2016 Yichang Liu
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vueDragula=e.vueDragula||{})}(this,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(e){var t=e.ctx,n=e.name,r=e.drake;return new U({ctx:t,name:n,drake:r})}function o(e){return new V(e)}function i(e){return!e||0===e.length}function a(e){function t(){var e;if(s.logging&&s.logging.plugin){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["vue-dragula plugin"].concat(n))}}function n(){var e;if(s.logging&&s.logging.service){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["vue-dragula service config: "].concat(n))}}function r(){var e;if(s.logging&&s.logging.directive){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["v-dragula directive"].concat(n))}}function o(e,t,n){if(t){var o=t.context.$dragula;if(o){r("trying to find and use component service");var i=o.service(n);if(i)return r("using component service",i),i}}return r("using global service",v),v}function a(e,t,n){var r=t?t.data.attrs.drake:this.params.drake,o=t?t.data.attrs.service:this.params.service;return void 0!==r&&0!==r.length&&(e=r),r=i(r)?"default":r,{name:e,drakeName:r,serviceName:o}}function u(e,t,n,i){r("updateDirective");var u=n?t.value:e;if(u){var s=a(f,n,this),l=s.name,d=s.drakeName,c=s.serviceName,v=o(l,n,c),h=v.find(d,n);g[d]=g[d]||[];var m=g[d];if(m){m.find(function(t){return t===e})}if(!v)return void r("no service found",l,d);h.models||(h.models=[]),n||(e=this.el);var p=v.findModelContainerByContainer(e,h);m.push(e),r("DATA",{service:{name:c,instance:v},drake:{name:d,instance:h},container:e,modelContainer:p}),p?(r("set model of container",u),p.model=u):(r("push model and container on drake",u,e),h.models.push({model:u,container:e}))}}var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.logging===!0&&(s.logging={plugin:!0,directive:!0,service:!0,dragHandler:!0}),t("Initializing vue-dragula plugin",s);var l=s.createService||K.createService,d=s.createEventBus||K.createEventBus||new e;t("create eventBus",d);var c=d(e,s);if(!c)throw console.warn("Eventbus could not be created"),new Error("Eventbus could not be created");t("eventBus created",c);var v=l({name:"global.dragula",eventBus:c,drakes:s.drakes,options:s}),f="globalDrake",h=function(){function e(t){L(this,e),this.options=t,this.$service={options:v.setOptions.bind(v),find:v.find.bind(v),eventBus:v.eventBus},this.$service.options("default",{}),this.createServices=this.createService}return X(e,[{key:"optionsFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.service(e).setOptions(t),this}},{key:"createService",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n("createService",e),this._serviceMap=this._serviceMap||{};var t=e.names||[],r=e.name||[],o=e.drakes||{},i=e.drake,a=Object.assign({},s,e);t=t.length>0?t:[r];var u=e.eventBus||v.eventBus;u||console.warn("Eventbus could not be created",u),n("names",t);var d=!0,c=!1,f=void 0;try{for(var h,g=t[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var m=h.value,p={name:m,eventBus:u,options:a};n("create DragulaService",m,p),this._serviceMap[m]=l(p),o.default||(o.default=i||!0),this.drakesFor(m,o)}}catch(e){c=!0,f=e}finally{try{!d&&g.return&&g.return()}finally{if(c)throw f}}return this}},{key:"drakesFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n("drakesFor",e,t);var r=this.service(e);Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]=!0,e},{}));var o=Object.keys(t),i=!0,a=!1,u=void 0;try{for(var s,l=o[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value,c=t[d];c===!0&&(c={}),r.setOptions(d,c)}}catch(e){a=!0,u=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw u}}return this}},{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n("on",e,t),"object"===("undefined"==typeof e?"undefined":H(e))){t=e;var r=this.serviceNames;if(!r||r.length<1)return console.warn("vue-dragula: No services found to add events handlers for",this._serviceMap),this;n("add event handlers for",r);var o=!0,i=!1,a=void 0;try{for(var u,s=r[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value;this.on(l,t)}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}return this}var d=this.service(e);return d?(n("service.on",d,t),d.on(t),this):(console.warn("vue-dragula: no service "+e+" to add event handlers for"),this)}},{key:"service",value:function(e){if(this._serviceMap){var t=this._serviceMap[e];if(n("lookup service",e,t),!t){n("not found by name, get default");var r=this.serviceNames;r&&(t=this._serviceMap[r[0]])}return t}}},{key:"serviceNames",get:function(){return Object.keys(this._serviceMap)}},{key:"services",get:function(){return Object.values(this._serviceMap)}}]),e}();e.$dragula=new h(s);var g={};e.prototype.$dragula=e.$dragula,e.directive("dragula",{params:["drake","service"],bind:function(e,t,n){r("BIND",e,t,n);var i=a(f,n,this),u=i.name,s=i.drakeName,l=i.serviceName,d=o(u,n,l),c=d.find(s,n);if(n||(e=this.el),r({service:{name:l,instance:d},drake:{name:s,instance:c},container:e}),c)return void c.containers.push(e);var v=$({containers:[e]});d.add(u,v),d.handleModels(u,v)},update:function(t,n,o,i){r("UPDATE",t,n,o),1===e.version&&u(t,n,o,i)},componentUpdated:function(e,t,n,o){r("COMPONENT UPDATED",e,t,n)},inserted:function(e,t,n,o){r("INSERTED",e,t,n),u(e,t,n,o)},unbind:function(e,t,n){r("UNBIND",e,t,n);var i=a(f,n,this),u=i.name,s=i.drakeName,l=i.serviceName,d=o(u,n,l),c=d.find(s,n);if(r({service:{name:l,instance:d},drake:{name:s,instance:c},container:e}),c){var v=c.containers.indexOf(e);v>-1&&(r("remove container",v),c.containers.splice(v,1)),0===c.containers.length&&(r("destroy service"),d.destroy(u))}}})}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u.installed&&console.warn("[vue-dragula] already installed."),console.log("Add Dragula plugin:",t),a(e,t)}var s="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l=n(function(e){e.exports=function(e,t){return Array.prototype.slice.call(e,t)}}),d=t(l),c=Object.freeze({default:d}),v=n(function(e){var t,n="function"==typeof setImmediate;t=n?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},e.exports=t}),f=t(v),h=Object.freeze({default:f}),g=n(function(e){var n=t(h);e.exports=function(e,t,r){e&&n(function(){e.apply(r||null,t||[])})}}),m=t(g),p=Object.freeze({default:m}),y=n(function(e){var n=t(c),r=t(p);e.exports=function(e,t){var o=t||{},i={};return void 0===e&&(e={}),e.on=function(t,n){return i[t]?i[t].push(n):i[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var r=arguments.length;if(1===r)delete i[t];else if(0===r)i={};else{var o=i[t];if(!o)return e;o.splice(o.indexOf(n),1)}return e},e.emit=function(){var t=n(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var a=(i[t]||[]).slice(0);return function(){var i=n(arguments),u=this||e;if("error"===t&&o.throws!==!1&&!a.length)throw 1===i.length?i[0]:i;return a.forEach(function(n){o.async?r(n,i,u):n.apply(u,i),n._once&&e.off(t,n)}),e}},e}}),k=t(y),b=Object.freeze({default:k}),M=n(function(e){function t(){try{var e=new n("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}var n=s.CustomEvent;e.exports=t()?n:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}),x=t(M),w=Object.freeze({default:x}),E=n(function(e){var t=[],n="",r=/^on/;for(n in s)r.test(n)&&t.push(n.slice(2));e.exports=t}),S=t(E),O=Object.freeze({default:S}),I=n(function(e){function n(e,t,n,r){return e.addEventListener(t,n,r)}function r(e,t,n){return e.attachEvent("on"+t,l(e,t,n))}function o(e,t,n,r){return e.removeEventListener(t,n,r)}function i(e,t,n){var r=d(e,t,n);if(r)return e.detachEvent("on"+t,r)}function a(e,t,n){function r(){var e;return h.createEvent?(e=h.createEvent("Event"),e.initEvent(t,!0,!0)):h.createEventObject&&(e=h.createEventObject()),e}function o(){return new v(t,{detail:n})}var i=f.indexOf(t)===-1?o():r();e.dispatchEvent?e.dispatchEvent(i):e.fireEvent("on"+t,i)}function u(e,t,n){return function(t){var r=t||s.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,n.call(e,r)}}function l(e,t,n){var r=d(e,t,n)||u(e,t,n);return p.push({wrapper:r,element:e,type:t,fn:n}),r}function d(e,t,n){var r=c(e,t,n);if(r){var o=p[r].wrapper;return p.splice(r,1),o}}function c(e,t,n){var r,o;for(r=0;r<p.length;r++)if(o=p[r],o.element===e&&o.type===t&&o.fn===n)return r}var v=t(w),f=t(O),h=s.document,g=n,m=o,p=[];s.addEventListener||(g=r,m=i),e.exports={add:g,remove:m,fabricate:a}}),N=t(I),C=I.add,B=I.remove,T=I.fabricate,A=Object.freeze({default:N,add:C,remove:B,fabricate:T}),D=n(function(e){function t(e){var t=o[e];return t?t.lastIndex=0:o[e]=t=new RegExp(i+e+a,"g"),t}function n(e,n){var r=e.className;r.length?t(n).test(r)||(e.className+=" "+n):e.className=n}function r(e,n){e.className=e.className.replace(t(n)," ").trim()}var o={},i="(?:^|\\s)",a="(?:\\s|$)";e.exports={add:n,rm:r}}),j=t(D),_=D.add,z=D.rm,P=Object.freeze({default:j,add:_,rm:z}),F=n(function(e){function n(e,t){function n(e){return de.containers.indexOf(e)!==-1||le.isContainer(e)}function a(e){var t=e?"remove":"add";r(E,t,"mousedown",S),r(E,t,"mouseup",j)}function s(e){var t=e?"remove":"add";r(E,t,"mousemove",O)}function g(e){var t=e?"remove":"add";M[t](E,"selectstart",b),M[t](E,"click",b)}function p(){a(!0),j({})}function b(e){ue&&e.preventDefault()}function S(e){te=e.clientX,ne=e.clientY;var t=1!==o(e)||e.metaKey||e.ctrlKey;if(!t){var n=e.target,r=I(n);r&&(ue=r,s(),"mousedown"===e.type&&(h(n)?n.focus():e.preventDefault()))}}function O(e){if(ue){if(0===o(e))return void j({});if(void 0===e.clientX||e.clientX!==te||void 0===e.clientY||e.clientY!==ne){if(le.ignoreInputTextSelection){var t=y("clientX",e),n=y("clientY",e),r=w.elementFromPoint(t,n);if(h(r))return}var a=ue;s(!0),g(),A(),B(a);var u=i(Q);Z=y("pageX",e)-u.left,ee=y("pageY",e)-u.top,x.add(ie||Q,"gu-transit"),R(),L(e)}}}function I(e){if(!(de.dragging&&q||n(e))){for(var t=e;f(e)&&n(f(e))===!1;){if(le.invalid(e,t))return;if(e=f(e),!e)return}var r=f(e);if(r&&!le.invalid(e,t)){var o=le.moves(e,r,t,m(e));if(o)return{item:e,source:r}}}}function N(e){return!!I(e)}function C(e){var t=I(e);t&&B(t)}function B(e){K(e.item,e.source)&&(ie=e.item.cloneNode(!0),de.emit("cloned",ie,e.item,"copy")),G=e.source,Q=e.item,re=oe=m(e.item),de.dragging=!0,de.emit("drag",Q,G)}function T(){return!1}function A(){if(de.dragging){var e=ie||Q;_(e,f(e))}}function D(){ue=!1,s(!0),g(!0)}function j(e){if(D(),de.dragging){var t=ie||Q,n=y("clientX",e),r=y("clientY",e),o=u(q,n,r),i=H(o,n,r);i&&(ie&&le.copySortSource||!ie||i!==G)?_(t,i):le.removeOnSpill?z():P()}}function _(e,t){var n=f(e);ie&&le.copySortSource&&t===G&&n.removeChild(Q),$(t)?de.emit("cancel",e,G,G):de.emit("drop",e,t,G,oe),F()}function z(){if(de.dragging){var e=ie||Q,t=f(e);t&&t.removeChild(e),de.emit(ie?"cancel":"remove",e,t,G),F()}}function P(e){if(de.dragging){var t=arguments.length>0?e:le.revertOnSpill,n=ie||Q,r=f(n),o=$(r);o===!1&&t&&(ie?r&&r.removeChild(ie):G.insertBefore(n,re)),o||t?de.emit("cancel",n,G,G):de.emit("drop",n,r,G,oe),F()}}function F(){var e=ie||Q;D(),U(),e&&x.rm(e,"gu-transit"),ae&&clearTimeout(ae),de.dragging=!1,se&&de.emit("out",e,se,G),de.emit("dragend",e),G=Q=ie=re=oe=ae=se=null}function $(e,t){var n;return n=void 0!==t?t:q?oe:m(ie||Q),e===G&&n===re}function H(e,t,r){function o(){var o=n(i);if(o===!1)return!1;var a=V(i,e),u=J(i,a,t,r),s=$(i,u);return!!s||le.accepts(Q,i,G,u)}for(var i=e;i&&!o();)i=f(i);return i}function L(e){function t(e){de.emit(e,l,se,G)}function n(){v&&t("over")}function r(){se&&t("out")}if(q){e.preventDefault();var o=y("clientX",e),i=y("clientY",e),a=o-Z,s=i-ee;q.style.left=a+"px",q.style.top=s+"px";var l=ie||Q,d=u(q,o,i),c=H(d,o,i),v=null!==c&&c!==se;(v||null===c)&&(r(),se=c,n());var h=f(l);if(c===G&&ie&&!le.copySortSource)return void(h&&h.removeChild(l));var g,p=V(c,d);if(null!==p)g=J(c,p,o,i);else{if(le.revertOnSpill!==!0||ie)return void(ie&&h&&h.removeChild(l));g=re,c=G}(null===g&&v||g!==l&&g!==m(l))&&(oe=g,c.insertBefore(l,g),de.emit("shadow",l,c,G))}}function X(e){x.rm(e,"gu-hide")}function Y(e){de.dragging&&x.add(e,"gu-hide")}function R(){if(!q){var e=Q.getBoundingClientRect();q=Q.cloneNode(!0),q.style.width=c(e)+"px",q.style.height=v(e)+"px",x.rm(q,"gu-transit"),x.add(q,"gu-mirror"),le.mirrorContainer.appendChild(q),r(E,"add","mousemove",L),x.add(le.mirrorContainer,"gu-unselectable"),de.emit("cloned",q,Q,"mirror")}}function U(){q&&(x.rm(le.mirrorContainer,"gu-unselectable"),r(E,"remove","mousemove",L),f(q).removeChild(q),q=null)}function V(e,t){for(var n=t;n!==e&&f(n)!==e;)n=f(n);return n===E?null:n}function J(e,t,n,r){function o(){var t,o,i,a=e.children.length;for(t=0;t<a;t++){if(o=e.children[t],i=o.getBoundingClientRect(),u&&i.left+i.width/2>n)return o;if(!u&&i.top+i.height/2>r)return o}return null}function i(){var e=t.getBoundingClientRect();return a(u?n>e.left+c(e)/2:r>e.top+v(e)/2)}function a(e){return e?m(t):t}var u="horizontal"===le.direction,s=t!==e?i():o();return s}function K(e,t){return"boolean"==typeof le.copy?le.copy:le.copy(e,t)}var W=arguments.length;1===W&&Array.isArray(e)===!1&&(t=e,e=[]);var q,G,Q,Z,ee,te,ne,re,oe,ie,ae,ue,se=null,le=t||{};void 0===le.moves&&(le.moves=d),void 0===le.accepts&&(le.accepts=d),void 0===le.invalid&&(le.invalid=T),void 0===le.containers&&(le.containers=e||[]),void 0===le.isContainer&&(le.isContainer=l),void 0===le.copy&&(le.copy=!1),void 0===le.copySortSource&&(le.copySortSource=!1),void 0===le.revertOnSpill&&(le.revertOnSpill=!1),void 0===le.removeOnSpill&&(le.removeOnSpill=!1),void 0===le.direction&&(le.direction="vertical"),void 0===le.ignoreInputTextSelection&&(le.ignoreInputTextSelection=!0),void 0===le.mirrorContainer&&(le.mirrorContainer=w.body);var de=k({containers:le.containers,start:C,end:A,cancel:P,remove:z,destroy:p,canMove:N,dragging:!1});return le.removeOnSpill===!0&&de.on("over",X).on("out",Y),a(),de}function r(e,t,n,r){var o={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},i={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},a={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};s.navigator.pointerEnabled?M[t](e,i[n],r):s.navigator.msPointerEnabled?M[t](e,a[n],r):(M[t](e,o[n],r),M[t](e,n,r))}function o(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function i(e){var t=e.getBoundingClientRect();return{left:t.left+a("scrollLeft","pageXOffset"),top:t.top+a("scrollTop","pageYOffset")}}function a(e,t){return"undefined"!=typeof s[t]?s[t]:E.clientHeight?E[e]:w.body[e]}function u(e,t,n){var r,o=e||{},i=o.className;return o.className+=" gu-hide",r=w.elementFromPoint(t,n),o.className=i,r}function l(){return!1}function d(){return!0}function c(e){return e.width||e.right-e.left}function v(e){return e.height||e.bottom-e.top}function f(e){return e.parentNode===w?null:e.parentNode}function h(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||g(e)}function g(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||g(f(e))))}function m(e){function t(){var t=e;do t=t.nextSibling;while(t&&1!==t.nodeType);return t}return e.nextElementSibling||t()}function p(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function y(e,t){var n=p(t),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in n)&&r[e]in n&&(e=r[e]),n[e]}var k=t(b),M=t(A),x=t(P),w=document,E=w.documentElement;e.exports=n}),$=t(F),H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var u={key:e,arg:t,resolve:n,reject:o,next:null};a?a=a.next=u:(i=a=u,r(e,t))})}function r(n,i){try{var a=t[n](i),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),X=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Y=window.requestAnimationFrame,R=Y?function(e){Y(function(){Y(e)})}:function(e){window.setTimeout(e,50)},U=function(){function e(t){var n=t.ctx,r=t.name,o=t.drake;t.options;L(this,e),this.dragElm=null,this.dragIndex=null,this.dropIndex=null,this.sourceModel=null,this.logging=n.logging,this.ctx=n,this.serviceName=n.name,this.modelManager=n.modelManager,this.drake=o,this.name=r,this.eventBus=n.eventBus,this.findModelForContainer=n.findModelForContainer.bind(n),this.domIndexOf=n.domIndexOf.bind(n)}return X(e,[{key:"log",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];this.shouldLog||(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}},{key:"removeModel",value:function(){this.log("removeModel",{sourceModel:this.sourceModel,dragIndex:this.dragIndex}),this.sourceModel.removeAt(this.dragIndex)}},{key:"dropModelSame",value:function(){this.log("dropModelSame",{sourceModel:this.sourceModel,dragIndex:this.dragIndex,dropIndex:this.dropIndex}),this.sourceModel.move({dropIndex:this.dropIndex,dragIndex:this.dragIndex})}},{key:"insertModel",value:function(e,t){this.log("insertModel",{targetModel:e,dropIndex:this.dropIndex,dropElmModel:t}),e.insertAt(this.dropIndex,t)}},{key:"notCopy",value:function(){var e=this;R(function(){e.sourceModel.removeAt(e.dragIndex)})}},{key:"cancelDrop",value:function(e){this.log("No targetModel could be found for target:",e),this.log("in drake:",this.drake),this.drake.cancel(!0)}},{key:"dropModelTarget",value:function(e,t,n){this.log("dropModelTarget",e,t,n);var r=this.dragElm===e,o=this.getModel(t),i=r?this.dropElmModel():this.jsonDropElmModel();return r&&this.notCopy(),o?void this.insertModel(o,i):this.cancelDrop(t)}},{key:"dropModel",value:function(e,t,n){this.log("dropModel",e,t,n),t===n?this.dropModelSame():this.dropModelTarget(e,t,n)}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.model=this.sourceModel,t.name=this.name;var n=this.serviceName+":"+e;this.log("emit",n,e,t),this.eventBus.$emit(e,t),this.eventBus.$emit(n,t)}},{key:"getModel",value:function(e){return this.modelManager.createFor({name:this.name,drake:this.drake,logging:this.logging,model:this.findModelForContainer(e,this.drake)})}},{key:"remove",value:function(e,t,n){return this.log("remove",e,t,n),this.drake.models?(this.sourceModel=this.getModel(n),this.removeModel(),this.drake.cancel(!0),void this.emit("removeModel",{el:e,source:n,dragIndex:this.dragIndex})):void this.log("Warning: Can NOT remove it. Must have models:",this.drake.models)}},{key:"drag",value:function(e,t){this.log("drag",e,t),this.dragElm=e,this.dragIndex=this.domIndexOf(e,t)}},{key:"drop",value:function(e,t,n){return this.log("drop",e,t,n),this.drake.models&&t?(this.dropIndex=this.domIndexOf(e,t),this.sourceModel=this.getModel(n),this.dropModel(e,t,n),void this.emit("dropModel",{target:t,source:n,el:e,dropIndex:this.dropIndex})):void this.log("Warning: Can NOT drop it. Must have either models:",this.drake.models," or target:",t)}},{key:"dropElmModel",value:function(){return this.sourceModel.at(this.dragIndex)}},{key:"jsonDropElmModel",value:function(){var e=this.sourceModel.at(this.dragIndex),t=e?e.model||e.stringable:e;return JSON.parse(JSON.stringify(t||e))}},{key:"clazzName",get:function(){return this.constructor.name||"DragHandler"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.dragHandler}}]),e}(),V=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L(this,e),Array.isArray(t)&&(t={model:t}),this.opts=t,this.name=t.name,this.drake=t.drake,this.history=t.history||this.createHistory(),this.model=this.createModel(t.model||[]),this.addToHistory(this.model),this.logging=t.logging,this.timeIndex=0,this.log("CREATE",t)}return X(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}}},{key:"undo",value:function(){this.log("undo","not yet implemented")}},{key:"redo",value:function(){this.log("redo","not yet implemented")}},{key:"addToHistory",value:function(e){Array.isArray(e)&&(e=this.createFor({model:e})),this.history.push(e),this.timeIndex++}},{key:"at",value:function(e){return this.model.get(e)}},{key:"createModel",value:function(e){return this.model||e||[]}},{key:"createHistory",value:function(){return this.history||[]}},{key:"createFor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t)}},{key:"removeAt",value:function(e){return this.log("removeAt",{model:this.model,index:e}),this.model.splice(e,1)}},{key:"insertAt",value:function(e,t){return this.log("insertAt",{model:this.model,index:e,dropModel:t}),this.model.splice(e,0,t)}},{key:"move",value:function(e){var t=e.dragIndex,n=e.dropIndex;return this.log("move",{model:this.model,dragIndex:t,dropIndex:n}),this.model.splice(n,0,this.model.splice(t,1)[0])}},{key:"clazzName",get:function(){return this.constructor.name||"ModelManager"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}}]),e}();if(!$)throw new Error("[vue-dragula] cannot locate dragula.");var J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};L(this,e);var n=t.name,i=t.eventBus,a=t.drakes,u=t.options;u=u||{},this.options=u,this.logging=u.logging,this.log("CREATE DragulaService",t),this.name=n,this.drakes=a||{},this.eventBus=i,this.createDragHandler=u.createDragHandler||r,this.createModelManager=u.createModelManager||o,this.modelManager=this.createModelManager(u),this.events=["cancel","cloned","drag","dragend","drop","out","over","remove","shadow","dropModel","removeModel"]}return X(e,[{key:"createModel",value:function(){return this.modelManager.createModel()}},{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,["DragulaService ["+this.name+"] :",e].concat(r))}}},{key:"error",value:function(e){throw console.error(e),new Error(e)}},{key:"_validate",value:function(e,t){t||this.error(e+" must take a drake name as the first argument")}},{key:"add",value:function(e,t){if(this.log("add (drake)",e,t),this._validate("add",e),this.find(e)){this.log("existing drakes",this.drakeNames);'Drake named: "'+e+'" already exists for this service ['+this.name+"]. \n      Most likely this error in cause by a race condition evaluating multiple template elements with \n      the v-dragula directive having the same drake name. Please initialise the drake in the created() life cycle hook of the VM to fix this problem.";this.error(msg)}return this.drakes[e]=t,t.models&&this.handleModels(e,t),t.initEvents||this.setupEvents(e,t),t}},{key:"find",value:function(e){return this.log("find (drake) by name",e),this._validate("find",e),this.drakes[e]}},{key:"handleModels",value:function(e,t){if(this.log("handleModels",e,t),this._validate("handleModels",e),t.registered)return void this.log("handleModels","already registered");var n=this.createDragHandler({ctx:this,name:e,drake:t});this.log("created dragHandler for service",n),t.on("remove",n.remove.bind(n)),t.on("drag",n.drag.bind(n)),t.on("drop",n.drop.bind(n)),t.registered=!0}},{key:"on",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.log("on (events) ",e);var t=Object.keys(e),n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var u=i.value,s=e[u];this.log("$on",u,s),this.eventBus.$on(u,s)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}},{key:"destroy",value:function(e){this.log("destroy (drake) ",e),this._validate("destroy",e);var t=this.find(e);t&&(t.destroy(),this._delete(e))}},{key:"_delete",value:function(e){delete this.drakes[e]}},{key:"setOptions",value:function(e,t){this.log("setOptions (drake)",e,t),this._validate("setOptions",e);var n=this.add(e,$(t));return this.handleModels(e,n),this}},{key:"setupEvents",value:function(e,t){function n(e,t){switch(e){case"cloned":return{clone:t[0],original:t[1],type:t[2]};case"drag":return{el:t[0],source:t[1]};case"dragend":return{el:t[0]};case"drop":return{el:t[0],target:t[1],source:t[2],sibling:t[3]};default:return{el:t[0],container:t[1],source:t[2]}}}this.log("setupEvents",e,t),this._validate("setupEvents",e),t.initEvents=!0;var r=this,o=function(o){function i(){var i=Array.prototype.slice.call(arguments),a=([e].concat(i),n(e,i));a.name=e,a.service=this,a.drake=t,r.log("eventBus.$emit",o,e,a),r.eventBus.$emit(o,a),r.eventBus.$emit(this.name+":"+o,a)}r.log("emitter",o),t.on(o,i)};this.events.forEach(o)}},{key:"domIndexOf",value:function(e,t){return Array.prototype.indexOf.call(t.children,e)}},{key:"findModelForContainer",value:function(e,t){return this.log("findModelForContainer",e,t),(this.findModelContainerByContainer(e,t)||{}).model}},{key:"findModelContainerByContainer",value:function(e,t){if(!t.models)return void this.log("findModelContainerByContainer","warning: no models found");var n=t.models.find(function(t){return t.container===e});return n||(this.log("No matching model could be found for container:",e),this.log("in drake",t.name," models:",t.models)),n}},{key:"shouldLog",get:function(){return this.logging&&this.logging.service}},{key:"drakeNames",get:function(){return Object.keys(this.drakes)}}]),e}();if(!$)throw new Error("[vue-dragula] cannot locate dragula.");var K={createService:function(e){var t=e.name,n=e.eventBus,r=e.drakes,o=e.options;return new J({name:t,eventBus:n,drakes:r,options:o})},createEventBus:function(e){return new e}};u.version="2.0.1";var W=u;"function"==typeof define&&define.amd?define([],function(){}):window.Vue&&window.Vue.use(u),e.Vue2Dragula=W,e.DragulaService=J,e.DragHandler=U,e.ModelManager=V});