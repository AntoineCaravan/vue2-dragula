/*!
 * vue-dragula v3.0.0
 * (c) 2017 Yichang Liu
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vueDragula=e.vueDragula||{})}(this,function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(e){var t=e.dh,n=e.service,r=e.options,o=void 0===r?{}:r;console.log(":: createModelHandler",t,o,se);var i=o.createModelHandler||se.createModelHandler;return i({dh:t,service:n,options:o})}function o(e){var t=e.dh,n=e.service,r=e.options,o=void 0===r?{}:r;console.log(":: createDragulaEventHandler",t,o,se);var i=o.createDragulaEventHandler||se.createDragulaEventHandler;return i({dh:t,service:n,options:o})}function i(e){return e===Object(e)}function a(e){return!e||0===e.length}function s(e,t,n){var r=t?t.data.attrs.drake:n.params.drake,o=t?t.data.attrs.service:n.params.service;return void 0!==r&&0!==r.length&&(e=r),r=a(r)?"default":r,{name:e,drakeName:r,serviceName:o}}function l(e){return e.charAt(0).toUpperCase()+e.slice(1)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.logging===!0&&(t.logging=t.defaultLogsOn||{plugin:!0,directive:!0,service:!0,dragHandler:!0,modelManager:!0});var n=t.createLogger||be.createLogger,r=n(t);r.plugin("Init: vue-dragula plugin",t);var o=t.createServiceManager||be.createServiceManager,i=o({Vue:e,options:t,log:r}),a=t.createDragula||be.createDragula;e.$dragula=a({serviceManager:i,log:r}),console.log("Created global $dragula"),e.prototype.$dragula=e.$dragula;var s=t.directive?t.directive.createCreator:null,l=s||be.createCreator;console.log("create main factory");var c=l({Vue:e,serviceManager:i,options:t,log:r});console.log("EXECUTE"),c.execute(),console.log("READY")}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};u.installed&&console.warn("[vue2-dragula] already installed."),console.log("Add Dragula plugin:",t),c(e,t)}var d="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=n(function(e){e.exports=function(e,t){return Array.prototype.slice.call(e,t)}}),v=t(h),g=Object.freeze({default:v}),f=n(function(e){var t,n="function"==typeof setImmediate;t=n?function(e){setImmediate(e)}:"undefined"!=typeof process&&process.nextTick?process.nextTick:function(e){setTimeout(e,0)},e.exports=t}),m=t(f),p=Object.freeze({default:m}),y=n(function(e){var n=t(p);e.exports=function(e,t,r){e&&n(function(){e.apply(r||null,t||[])})}}),M=t(y),k=Object.freeze({default:M}),b=n(function(e){var n=t(g),r=t(k);e.exports=function(e,t){var o=t||{},i={};return void 0===e&&(e={}),e.on=function(t,n){return i[t]?i[t].push(n):i[t]=[n],e},e.once=function(t,n){return n._once=!0,e.on(t,n),e},e.off=function(t,n){var r=arguments.length;if(1===r)delete i[t];else if(0===r)i={};else{var o=i[t];if(!o)return e;o.splice(o.indexOf(n),1)}return e},e.emit=function(){var t=n(arguments);return e.emitterSnapshot(t.shift()).apply(this,t)},e.emitterSnapshot=function(t){var a=(i[t]||[]).slice(0);return function(){var i=n(arguments),s=this||e;if("error"===t&&o.throws!==!1&&!a.length)throw 1===i.length?i[0]:i;return a.forEach(function(n){o.async?r(n,i,s):n.apply(s,i),n._once&&e.off(t,n)}),e}},e}}),x=t(b),w=Object.freeze({default:x}),E=n(function(e){function t(){try{var e=new n("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}var n=d.CustomEvent;e.exports=t()?n:"function"==typeof document.createEvent?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=Boolean(t.bubbles),n.cancelable=Boolean(t.cancelable),n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n}}),O=t(E),_=Object.freeze({default:O}),D=n(function(e){var t=[],n="",r=/^on/;for(n in d)r.test(n)&&t.push(n.slice(2));e.exports=t}),S=t(D),C=Object.freeze({default:S}),N=n(function(e){function n(e,t,n,r){return e.addEventListener(t,n,r)}function r(e,t,n){return e.attachEvent("on"+t,l(e,t,n))}function o(e,t,n,r){return e.removeEventListener(t,n,r)}function i(e,t,n){var r=c(e,t,n);if(r)return e.detachEvent("on"+t,r)}function a(e,t,n){function r(){var e;return g.createEvent?(e=g.createEvent("Event"),e.initEvent(t,!0,!0)):g.createEventObject&&(e=g.createEventObject()),e}function o(){return new h(t,{detail:n})}var i=v.indexOf(t)===-1?o():r();e.dispatchEvent?e.dispatchEvent(i):e.fireEvent("on"+t,i)}function s(e,t,n){return function(t){var r=t||d.event;r.target=r.target||r.srcElement,r.preventDefault=r.preventDefault||function(){r.returnValue=!1},r.stopPropagation=r.stopPropagation||function(){r.cancelBubble=!0},r.which=r.which||r.keyCode,n.call(e,r)}}function l(e,t,n){var r=c(e,t,n)||s(e,t,n);return p.push({wrapper:r,element:e,type:t,fn:n}),r}function c(e,t,n){var r=u(e,t,n);if(r){var o=p[r].wrapper;return p.splice(r,1),o}}function u(e,t,n){var r,o;for(r=0;r<p.length;r++)if(o=p[r],o.element===e&&o.type===t&&o.fn===n)return r}var h=t(_),v=t(C),g=d.document,f=n,m=o,p=[];d.addEventListener||(f=r,m=i),e.exports={add:f,remove:m,fabricate:a}}),A=t(N),H=N.add,T=N.remove,j=N.fabricate,I=Object.freeze({default:A,add:H,remove:T,fabricate:j}),B=n(function(e){function t(e){var t=o[e];return t?t.lastIndex=0:o[e]=t=new RegExp(i+e+a,"g"),t}function n(e,n){var r=e.className;r.length?t(n).test(r)||(e.className+=" "+n):e.className=n}function r(e,n){e.className=e.className.replace(t(n)," ").trim()}var o={},i="(?:^|\\s)",a="(?:\\s|$)";e.exports={add:n,rm:r}}),P=t(B),z=B.add,R=B.rm,F=Object.freeze({default:P,add:z,rm:R}),V=n(function(e){function n(e,t){function n(e){return ue.containers.indexOf(e)!==-1||ce.isContainer(e)}function a(e){var t=e?"remove":"add";r(E,t,"mousedown",O),r(E,t,"mouseup",j)}function d(e){var t=e?"remove":"add";r(E,t,"mousemove",_)}function f(e){var t=e?"remove":"add";k[t](E,"selectstart",w),k[t](E,"click",w)}function p(){a(!0),j({})}function w(e){se&&e.preventDefault()}function O(e){te=e.clientX,ne=e.clientY;var t=1!==o(e)||e.metaKey||e.ctrlKey;if(!t){var n=e.target,r=D(n);r&&(se=r,d(),"mousedown"===e.type&&(g(n)?n.focus():e.preventDefault()))}}function _(e){if(se){if(0===o(e))return void j({});if(void 0===e.clientX||e.clientX!==te||void 0===e.clientY||e.clientY!==ne){if(ce.ignoreInputTextSelection){var t=y("clientX",e),n=y("clientY",e),r=x.elementFromPoint(t,n);if(g(r))return}var a=se;d(!0),f(),H(),N(a);var s=i(Q);Z=y("pageX",e)-s.left,ee=y("pageY",e)-s.top,b.add(ie||Q,"gu-transit"),$(),V(e)}}}function D(e){if(!(ue.dragging&&W||n(e))){for(var t=e;v(e)&&n(v(e))===!1;){if(ce.invalid(e,t))return;if(e=v(e),!e)return}var r=v(e);if(r&&!ce.invalid(e,t)){var o=ce.moves(e,r,t,m(e));if(o)return{item:e,source:r}}}}function S(e){return!!D(e)}function C(e){var t=D(e);t&&N(t)}function N(e){J(e.item,e.source)&&(ie=e.item.cloneNode(!0),ue.emit("cloned",ie,e.item,"copy")),q=e.source,Q=e.item,re=oe=m(e.item),ue.dragging=!0,ue.emit("drag",Q,q)}function A(){return!1}function H(){if(ue.dragging){var e=ie||Q;I(e,v(e))}}function T(){se=!1,d(!0),f(!0)}function j(e){if(T(),ue.dragging){var t=ie||Q,n=y("clientX",e),r=y("clientY",e),o=s(W,n,r),i=F(o,n,r);i&&(ie&&ce.copySortSource||!ie||i!==q)?I(t,i):ce.removeOnSpill?B():P()}}function I(e,t){var n=v(e);ie&&ce.copySortSource&&t===q&&n.removeChild(Q),R(t)?ue.emit("cancel",e,q,q):ue.emit("drop",e,t,q,oe),z()}function B(){if(ue.dragging){var e=ie||Q,t=v(e);t&&t.removeChild(e),ue.emit(ie?"cancel":"remove",e,t,q),z()}}function P(e){if(ue.dragging){var t=arguments.length>0?e:ce.revertOnSpill,n=ie||Q,r=v(n),o=R(r);o===!1&&t&&(ie?r&&r.removeChild(ie):q.insertBefore(n,re)),o||t?ue.emit("cancel",n,q,q):ue.emit("drop",n,r,q,oe),z()}}function z(){var e=ie||Q;T(),X(),e&&b.rm(e,"gu-transit"),ae&&clearTimeout(ae),ue.dragging=!1,le&&ue.emit("out",e,le,q),ue.emit("dragend",e),q=Q=ie=re=oe=ae=le=null}function R(e,t){var n;return n=void 0!==t?t:W?oe:m(ie||Q),e===q&&n===re}function F(e,t,r){function o(){var o=n(i);if(o===!1)return!1;var a=Y(i,e),s=G(i,a,t,r),l=R(i,s);return!!l||ce.accepts(Q,i,q,s)}for(var i=e;i&&!o();)i=v(i);return i}function V(e){function t(e){ue.emit(e,c,le,q)}function n(){h&&t("over")}function r(){le&&t("out")}if(W){e.preventDefault();var o=y("clientX",e),i=y("clientY",e),a=o-Z,l=i-ee;W.style.left=a+"px",W.style.top=l+"px";var c=ie||Q,u=s(W,o,i),d=F(u,o,i),h=null!==d&&d!==le;(h||null===d)&&(r(),le=d,n());var g=v(c);if(d===q&&ie&&!ce.copySortSource)return void(g&&g.removeChild(c));var f,p=Y(d,u);if(null!==p)f=G(d,p,o,i);else{if(ce.revertOnSpill!==!0||ie)return void(ie&&g&&g.removeChild(c));f=re,d=q}(null===f&&h||f!==c&&f!==m(c))&&(oe=f,d.insertBefore(c,f),ue.emit("shadow",c,d,q))}}function L(e){b.rm(e,"gu-hide")}function U(e){ue.dragging&&b.add(e,"gu-hide")}function $(){if(!W){var e=Q.getBoundingClientRect();W=Q.cloneNode(!0),W.style.width=u(e)+"px",W.style.height=h(e)+"px",b.rm(W,"gu-transit"),b.add(W,"gu-mirror"),ce.mirrorContainer.appendChild(W),r(E,"add","mousemove",V),b.add(ce.mirrorContainer,"gu-unselectable"),ue.emit("cloned",W,Q,"mirror")}}function X(){W&&(b.rm(ce.mirrorContainer,"gu-unselectable"),r(E,"remove","mousemove",V),v(W).removeChild(W),W=null)}function Y(e,t){for(var n=t;n!==e&&v(n)!==e;)n=v(n);return n===E?null:n}function G(e,t,n,r){function o(){var t,o,i,a=e.children.length;for(t=0;t<a;t++){if(o=e.children[t],i=o.getBoundingClientRect(),s&&i.left+i.width/2>n)return o;if(!s&&i.top+i.height/2>r)return o}return null}function i(){var e=t.getBoundingClientRect();return a(s?n>e.left+u(e)/2:r>e.top+h(e)/2)}function a(e){return e?m(t):t}var s="horizontal"===ce.direction,l=t!==e?i():o();return l}function J(e,t){return"boolean"==typeof ce.copy?ce.copy:ce.copy(e,t)}var K=arguments.length;1===K&&Array.isArray(e)===!1&&(t=e,e=[]);var W,q,Q,Z,ee,te,ne,re,oe,ie,ae,se,le=null,ce=t||{};void 0===ce.moves&&(ce.moves=c),void 0===ce.accepts&&(ce.accepts=c),void 0===ce.invalid&&(ce.invalid=A),void 0===ce.containers&&(ce.containers=e||[]),void 0===ce.isContainer&&(ce.isContainer=l),void 0===ce.copy&&(ce.copy=!1),void 0===ce.copySortSource&&(ce.copySortSource=!1),void 0===ce.revertOnSpill&&(ce.revertOnSpill=!1),void 0===ce.removeOnSpill&&(ce.removeOnSpill=!1),void 0===ce.direction&&(ce.direction="vertical"),void 0===ce.ignoreInputTextSelection&&(ce.ignoreInputTextSelection=!0),void 0===ce.mirrorContainer&&(ce.mirrorContainer=x.body);var ue=M({containers:ce.containers,start:C,end:H,cancel:P,remove:B,destroy:p,canMove:S,dragging:!1});return ce.removeOnSpill===!0&&ue.on("over",L).on("out",U),a(),ue}function r(e,t,n,r){var o={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},i={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},a={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};d.navigator.pointerEnabled?k[t](e,i[n],r):d.navigator.msPointerEnabled?k[t](e,a[n],r):(k[t](e,o[n],r),k[t](e,n,r))}function o(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var t=e.button;return void 0!==t?1&t?1:2&t?3:4&t?2:0:void 0}function i(e){var t=e.getBoundingClientRect();return{left:t.left+a("scrollLeft","pageXOffset"),top:t.top+a("scrollTop","pageYOffset")}}function a(e,t){return"undefined"!=typeof d[t]?d[t]:E.clientHeight?E[e]:x.body[e]}function s(e,t,n){var r,o=e||{},i=o.className;return o.className+=" gu-hide",r=x.elementFromPoint(t,n),o.className=i,r}function l(){return!1}function c(){return!0}function u(e){return e.width||e.right-e.left}function h(e){return e.height||e.bottom-e.top}function v(e){return e.parentNode===x?null:e.parentNode}function g(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||f(e)}function f(e){return!!e&&("false"!==e.contentEditable&&("true"===e.contentEditable||f(v(e))))}function m(e){function t(){var t=e;do t=t.nextSibling;while(t&&1!==t.nodeType);return t}return e.nextElementSibling||t()}function p(e){return e.targetTouches&&e.targetTouches.length?e.targetTouches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e}function y(e,t){var n=p(t),r={pageX:"clientX",pageY:"clientY"};return e in r&&!(e in n)&&r[e]in n&&(e=r[e]),n[e]}var M=t(w),k=t(I),b=t(F),x=document,E=x.documentElement;e.exports=n}),L=t(V),U=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,o){var s={key:e,arg:t,resolve:n,reject:o,next:null};a?a=a.next=s:(i=a=s,r(e,t))})}function r(n,i){try{var a=t[n](i),s=a.value;s instanceof e?Promise.resolve(s.value).then(function(e){r("next",e)},function(e){r("throw",e)}):o(a.done?"return":"normal",a.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}i=i.next,i?r(i.key,i.arg):a=null}var i,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),$=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),X=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},Y=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},G=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,e),Array.isArray(t)&&(t={model:t}),this.opts=t,this.name=t.name,this.groupProp=t.groupProp||"group",this.modelRef=t.model||[],this.model=this.createModel(this.modelRef),this.logging=t.logging,this.log("CREATE",t)}return $(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}}},{key:"undo",value:function(){this.log("undo","not yet implemented")}},{key:"redo",value:function(){this.log("redo","not yet implemented")}},{key:"at",value:function(e){return this.model.get?this.model.get(e):this.model[e]}},{key:"clear",value:function(){this.model=this.createModel()}},{key:"createModel",value:function(e){return this.model||e||[]}},{key:"createFor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t)}},{key:"removeAt",value:function(e){var t=e.indexes,n=t.drag;return this.log("removeAt",{model:this.model,index:n}),this.model.splice(n,1)}},{key:"insertAt",value:function(e){var t=e.indexes,n=e.models,r=t.drop,o=n.transit;return this.log("insertAt",{model:this.model,index:r,dropModel:o}),this.model.splice(r,0,o)}},{key:"move",value:function(e){var t=e.indexes;this.log("move",{model:this.model,indexes:t});var n=this.model.splice(t.drag,1)[0];return this.model.splice(t.drop,0,n)}},{key:"clazzName",get:function(){return this.constructor.name||"ModelManager"}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}}]),e}(),K=n(function(e){function t(e,n){return this instanceof t?(this.proto=e,this.target=n,this.methods=[],this.getters=[],this.setters=[],void(this.fluents=[])):new t(e,n)}e.exports=t,t.prototype.method=function(e){var t=this.proto,n=this.target;return this.methods.push(e),t[e]=function(){return this[n][e].apply(this[n],arguments)},this},t.prototype.access=function(e){return this.getter(e).setter(e)},t.prototype.getter=function(e){var t=this.proto,n=this.target;return this.getters.push(e),t.__defineGetter__(e,function(){return this[n][e]}),this},t.prototype.setter=function(e){var t=this.proto,n=this.target;return this.setters.push(e),t.__defineSetter__(e,function(t){return this[n][e]=t}),this},t.prototype.fluent=function(e){var t=this.proto,n=this.target;return this.fluents.push(e),t[e]=function(t){return"undefined"!=typeof t?(this[n][e]=t,this):this[n][e]},this}}),W=t(K),q=function(){function e(){U(this,e)}return $(e,[{key:"delegateFor",value:function(e,t){var n=t.props,r=void 0===n?[]:n,o=t.methods,i=void 0===o?[]:o;return console.log("delegateFor",e,r,i),this[e]?(this.delegateProps(e,r),void this.delegateMethods(e,i)):void console.log("skip delegation, no delegation obj",this[e])}},{key:"delegateMethods",value:function(e,t){var n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;W(this,e).method(s)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}},{key:"delegateProps",value:function(e,t){console.log("delegateProps access",t);var n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;W(this,e).access(s)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}}]),e}(),Q=function(e){function t(e){var n=e.dh,r=e.service,o=e.name,i=e.drake,a=e.dragModel,s=e.options,l=void 0===s?{}:s;U(this,t);var c=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n&&(c.dh=n),c.configDelegates(),c.name=o,c.drake=i,c.dragModel=c.dragModel||a,c.logging=r.logging,c.service=r,c.logger=l.logger||console,c.options=l,c}return Y(t,e),$(t,[{key:"configDelegates",value:function(){this.dh&&this.delegateFor("dh",{props:["drake","dragModel","modelHandler","dragulaEventHandler"]}),this.delegateFor("service",{props:["eventBus","modelManager"],methods:["findModelForContainer","domIndexOf"]}),this.delegateFor("dragModel",{props:["sourceModel","targetModel","dragIndex","dropIndex","dragElm"]})}},{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.logger).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}}},{key:"createCtx",value:function(e){var t=e.el,n=e.source,r=e.target,o=e.models;return{element:t,containers:{source:n,target:r},indexes:this.indexes,models:o}}},{key:"getModel",value:function(e){return this.log("getModel",e,this),this.modelManager.createFor({name:this.name,logging:this.logging,model:this.findModelForContainer(e,this.drake)})}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.sourceModel=this.sourceModel,t.name=this.name;var n=this.serviceName+":"+e;this.log("emit",n,e,t),this.eventBus.$emit(e,t),this.eventBus.$emit(n,t)}},{key:"clazzName",get:function(){return this.constructor.name}},{key:"shouldLog",get:function(){return this.logging&&this.logging.dragHandler}},{key:"indexes",get:function(){return{indexes:{source:this.dragIndex,target:this.dropIndex}}}}]),t}(q),Z=function e(t){U(this,e),this.opts=t},ee=function(e){function t(e){var n=e.dh,r=e.service,o=e.dragModel,i=e.options;U(this,t);var a=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{dh:n,service:r,dragModel:o,options:i}));return console.log("DragulaEventHandler: dh",a.dh),a}return Y(t,e),$(t,[{key:"configDelegates",value:function(){X(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"configDelegates",this).call(this),this.delegateFor("dh",{props:["dragElm","drake"]}),this.delegateFor("modelHandler",{methods:["removeModel","insertModel","notCopy","dropModel","dropModelSame"]})}},{key:"setModel",value:function(e,t){this[e]=this.getModel(t)}},{key:"setIndex",value:function(e,t){var n=t.el,r=t.source;this[e]=this.domIndexOf(n,r)}},{key:"remove",value:function(e,t,n){if(this.log(":: REMOVE",e,t,n),!this.drake.models)return void this.log("Warning: Can NOT remove it. Must have models:",this.drake.models);this.setSourceModel(n);var r=this.createCtx({el:e,source:n});this.removeModel(r),this.drake.cancel(!0),this.emit("removeModel",r)}},{key:"drag",value:function(e,t){this.log(":: DRAG",e,t),this.dragElm=e,this.setIndex("dragIndex",{el:e,source:t}),this.log("DRAGGED: dragIndex = ",this.dragIndex),this.log("dragModel",this.dragModel)}},{key:"drop",value:function(e,t,n,r){if(this.log(":: DROP",e,t,n),!this.drake.models||!t)return void this.log("Warning: Can NOT drop it. Must have either models:",this.drake.models," or target:",t);this.setIndex("dropIndex",{el:e,source:n}),this.setModel("sourceModel",n),console.log("sourceModel",this.sourceModel,this.dh.sourceModel);var o=this.createCtx({el:e,target:t,source:n});this.dropModel(o),this.emit("dropModel",o)}},{key:"clazzName",get:function(){return this.constructor.name||"DragulaEventHandler"}}]),t}(Q),te=window.requestAnimationFrame,ne=te?function(e){te(function(){te(e)})}:function(e){window.setTimeout(e,50)},re=function(e){function t(e){var n=e.dh,r=e.noCopy;U(this,t);var o=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return console.log("create DropModelBuilder",n),o.dh=n,o.noCopy=r,o.dragModel=n.dragModel,o.configDelegates(),console.log("delegates for",o.dragModel,{sourceModel:o.sourceModel,dragIndex:o.dragIndex}),o}return Y(t,e),$(t,[{key:"configDelegates",value:function(){this.delegateFor("dragModel",{props:["sourceModel","dragIndex"]})}},{key:"dropElmModel",value:function(){return this.sourceModel.at(this.dragIndex)}},{key:"jsonDropElmModel",value:function(){var e=this.dropElmModel(),t=e?e.model||e.stringable:e;return JSON.parse(JSON.stringify(t||e))}},{key:"model",get:function(){return this.noCopy?this.dropElmModel():this.jsonDropElmModel()}}]),t}(q),oe=function(e){function t(e){var n=e.dh,r=e.service,o=e.ctx;U(this,t);var i=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{dh:n,service:r}));return i.ctx=o,i.delegateFor("dh",{methods:["notCopy","insertModel"]}),i}return Y(t,e),$(t,[{key:"setNoCopy",value:function(){this.noCopy=this.dragElm===this.ctx.element}},{key:"setTargetModel",value:function(){this.targetModel=this.getModel(this.ctx.containers.target)}},{key:"createdropModel",value:function(){return new re({dh:this.dh,noCopy:this.noCopy})}},{key:"setDropModel",value:function(){this.dropModel=this.createdropModel().model}},{key:"models",value:function(){return this.setTargetModel(),this.setDropModel(),{models:{target:this.targetModel,drop:this.dropModel}}}},{key:"cancelDrop",value:function(e){this.targetModel||(this.log("No targetModel could be found for target:",e.containers.target,e),this.log("in drake:",this.drake),this.drake.cancel(!0))}},{key:"handle",value:function(){this.log("dropModelTarget",this.ctx),this.setNoCopy();var e=Object.assign(this.ctx,this.models(),{noCopy:this.noCopy});this.notCopy({ctx:e}),this.cancelDrop(e),this.insertModel(e)}},{key:"clazzName",get:function(){return this.constructor.name||"DropModelHandler"}}]),t}(Q),ie=function(e){function t(e){var n=e.dh,r=e.service,o=e.dragModel,i=e.options;return U(this,t),G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{dh:n,service:r,dragModel:o,options:i}))}return Y(t,e),$(t,[{key:"context",value:function(e){return Object.assign(e,this.models,this.indexes)}},{key:"notCopy",value:function(e){var t=this,n=e.ctx;n.noCopy&&ne(function(){n=t.context(n),t.sourceModel.removeAt(n)})}},{key:"removeModel",value:function(e){e=this.context(e),this.log("removeModel",e),this.sourceModel.removeAt(e)}},{key:"insertModel",value:function(e){e=this.context(e),this.log("insertModel",e),this.targetModel.insertAt(e),this.emit("insertAt",e)}},{key:"dropModel",value:function(e){var t=e,n=t.containers;this.log("dropModel",e),e=Object.assign(e,this.indexes),n.target===n.source?this.dropModelSame(e):this.dropModelTarget(e)}},{key:"dropModelSame",value:function(e){e=this.context(e),this.log("dropModelSame",e),this.sourceModel.move(e)}},{key:"createDropModelHandler",value:function(e){return new oe({dh:this.dh,service:this.service,ctx:e})}},{key:"dropModelTarget",value:function(e){this.log("dropModelTarget: dragModel",this.dh.dragModel),this.createDropModelHandler().handle()}},{key:"clazzName",get:function(){return this.constructor.name||"ModelHandler"}},{key:"models",get:function(){return{models:{source:this.sourceModel}}}}]),t}(Q),ae=function(e){function t(e){var n=e.service,r=e.name,o=e.drake,i=e.options,a=void 0===i?{}:i;U(this,t);var s=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{service:n,options:a}));return console.log("DragHandler constructor",a),s.drake=o,s.name=r,s.dragModel=new Z,s.configModelHandler(),s.configEventHandler(),s}return Y(t,e),$(t,[{key:"configModelHandler",value:function(){console.log("configModelHandler"),this.modelHandler=r(this.args)}},{key:"configEventHandler",value:function(){console.log("configEventHandler",this.args);var e=Object.assign(this.args,{dragulaEventHandler:this.dragulaEventHandler});this.dragulaEventHandler=o(e),console.log("delegateFor:: dragulaEventHandler",this.dragulaEventHandler),this.delegateFor("dragulaEventHandler",["remove","drag","drop"])}},{key:"args",get:function(){return{dh:this,name:this.name,drake:this.drake,service:this.service,dragModel:this.dragModel,options:this.options}}},{key:"clazzName",get:function(){return this.constructor.name||"DragHandler"}}]),t}(Q),se={createDragHandler:function(e){var t=e.service,n=e.name,r=e.drake;return console.log("createDragHandler: ",ae),new ae({service:t,name:n,drake:r})},createModelHandler:function(e){var t=e.dh,n=e.service,r=e.options;return new ie({service:n,dh:t,options:r})},createDragulaEventHandler:function(e){var t=e.dh,n=e.service,r=e.options;return new ee({service:n,dh:t,options:r})},createModelManager:function(e){return console.log("createModelManager:",e),new J(e)}};if(!L)throw new Error("[vue-dragula] cannot locate dragula.");var le=se.createDragHandler,ce=se.createModelManager,ue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,e),console.log("constructor DragulaService",t);var n=t.name,r=t.eventBus,o=t.drakes,i=t.options;this.opts=t,this.options=i||{},this.logging=i.logging,console.log("DragulaService log",this.logging),this.log(":: CREATE DragulaService",t,"options:",i.createDragHandler),this.name=n,this.drakes=o||{},this.eventBus=r,this.createDragHandler=i.createDragHandler||le,this.createModelManager=i.createModelManager||ce,this.log("createDragHandler factory",this.createDragHandler),this.modelManager=this.createModelManager(i),this.events=["cancel","cloned","drag","dragend","drop","out","over","remove","shadow","dropModel","removeModel"],this.validate()}return $(e,[{key:"validate",value:function(){this.eventBus||this.error("Missing eventBus",this.opts),this.modelManager||this.error("Missing modelManager",this.opts),this.drakes||this.error("Missing drakes",this.opts)}},{key:"createModel",value:function(){return this.modelManager.createModel()}},{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,["DragulaService ["+this.name+"] :",e].concat(r))}}},{key:"error",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];throw(t=console).error.apply(t,[e].concat(r)),new Error(e)}},{key:"_validate",value:function(e,t){t||this.error(e+" must take a drake name as the first argument")}},{key:"add",value:function(e,t){if(this.log("add (drake)",e,t),this._validate("add",e),this.find(e)){this.log("existing drakes",this.drakeNames);var n='Drake named: "'+e+'" already exists for this service ['+this.name+"].\n      Most likely this error in cause by a race condition evaluating multiple template elements with\n      the v-dragula directive having the same drake name. Please initialise the drake in the created() life cycle hook of the VM to fix this problem.";this.error(n)}return this.drakes[e]=t,t.models&&this.handleModels(e,t),t.initEvents||this.setupEvents(e,t),t}},{key:"find",value:function(e){return this.log("find (drake) by name",e),this._validate("find",e),this.drakes[e]}},{key:"handleModels",value:function(e,t){if(this.log("handleModels",e,t),this._validate("handleModels",e),t.registered)return void this.log("handleModels","already registered");this.log("creating service DragHandler for models",e,t);var n=this.createDragHandler({service:this,name:e,drake:t});if(!n)throw new Error("DragHandler could not be created");this.log("created dragHandler for service",n),t.on("remove",n.remove.bind(n)),t.on("drag",n.drag.bind(n)),t.on("drop",n.drop.bind(n)),t.registered=!0}},{key:"on",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.log("on (events) ",e);var t=Object.keys(e),n=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value,l=e[s];this.log("$on",s,l),this.eventBus.$on(s,l)}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}},{key:"destroy",value:function(e){this.log("destroy (drake) ",e),this._validate("destroy",e);var t=this.find(e);t&&(t.destroy(),this._delete(e))}},{key:"_delete",value:function(e){delete this.drakes[e]}},{key:"setOptions",value:function(e,t){this.log("setOptions (drake)",e,t),this._validate("setOptions",e);var n=this.add(e,L(t));return this.handleModels(e,n),this}},{key:"setupEvents",value:function(e,t){function n(e,t){switch(e){case"cloned":return{clone:t[0],original:t[1],type:t[2]};case"drag":return{el:t[0],source:t[1]};case"dragend":return{el:t[0]};case"drop":return{el:t[0],target:t[1],source:t[2],sibling:t[3]};default:return{el:t[0],container:t[1],source:t[2]}}}this.log("setupEvents",e,t),this._validate("setupEvents",e),t.initEvents=!0;var r=this,o=function(o){function i(){var i=Array.prototype.slice.call(arguments),a=n(e,i);a.name=e,a.service=this,a.drake=t,r.log("eventBus.$emit",o,e,a),r.eventBus.$emit(o,a),r.eventBus.$emit(this.name+":"+o,a)}r.log("emitter",o),t.on(o,i)};this.events.forEach(o)}},{key:"domIndexOf",value:function(e,t){return Array.prototype.indexOf.call(t.children,e)}},{key:"findModelForContainer",value:function(e,t){return this.log("findModelForContainer",e,t),t||this.error("findModelForContainer","missing drake argument"),(this.findModelContainer(e,t)||{}).model}},{key:"findModelContainer",value:function(e,t){if(t||this.error("findModelContainer","missing drake argument"),!t.models)return void this.log("findModelContainer","warning: no models on drake");var n=t.models.find(function(t){return t.container===e});return n||(this.log("No matching model could be found for container:",e),this.log("in drake",t.name," models:",t.models)),n}},{key:"shouldLog",get:function(){return this.logging&&this.logging.service}},{key:"drakeNames",get:function(){return Object.keys(this.drakes)}}]),e}(),de=function(){function e(t){var n=t.name,r=t.model,o=t.modelRef,i=t.history,a=t.logging;U(this,e),this.name=n||"default",this.model=r,this.modelRef=o,this.logging=a,this.history=i||this.createHistory(),this.history.push(this.model),this.timeIndex=0}return $(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}}},{key:"createHistory",value:function(){return this.history||[]}},{key:"timeTravel",value:function(e){return this.log("timeTravel to",e),this.model=this.history[e],
this.updateModelRef(),this}},{key:"updateModelRef",value:function(){this.modelRef.splice(0,this.modelRef.length);var e=!0,t=!1,n=void 0;try{for(var r,o=this.model[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.modelRef.push(i)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},{key:"undo",value:function(){return this.log("undo timeIndex",this.timeIndex),0!==this.timeIndex&&(this.timeIndex--,this.timeTravel(this.timeIndex),this)}},{key:"redo",value:function(){return this.log("redo timeIndex",this.timeIndex,this.history.length),!(this.timeIndex>this.history.length-1)&&(this.timeIndex++,this.timeTravel(this.timeIndex),this)}},{key:"addToHistory",value:function(e){return this.log("addToHistory"),this.log("old",this.model),this.log("new",e),this.model=e,this.log("model was set to",this.model),this.history.push(e),this.timeIndex++,this.updateModelRef(),this}},{key:"shouldLog",get:function(){return this.logging&&this.logging.modelManager}},{key:"clazzName",get:function(){return this.constructor.name||"TimeMachine"}}]),e}(),he={createTimeMachine:function(e){return new de(e)},createService:function(e){var t=e.name,n=e.eventBus,r=e.drakes,o=e.options;return console.log("default createService",{name:t,eventBus:n,drakes:r,options:o}),new ue({name:t,eventBus:n,drakes:r,options:o})}},ve=function(){function e(t){var n=t.Vue,r=t.options,o=(t.eventBus,t.log);if(U(this,e),this.log=o.dir,this.log("create ServiceManager",r),this.Vue=n,this.options=r,this.buildService=r.createService||he.createService,console.log("creating Eventbus"),this.createEventbus(),!this.buildService)throw new Error("ServiceManager:: No function to build Service");console.log("building global service"),this.appService=this.buildService({name:"global.dragula",eventBus:this.eventBus,drakes:r.drakes,options:r})}return $(e,[{key:"createEventbus",value:function(){console.log("createEventbus");var e=this.options.createEventBus||be.createEventBus;if(this.eventBus=e(this.Vue,this.options)||new this.Vue,!this.eventBus)throw console.warn("Eventbus could not be created"),new Error("Eventbus could not be created")}},{key:"findService",value:function(e,t,n){if(t){var r=t.context.$dragula;if(r){this.log("trying to find and use component service");var o=r.service(n);if(o)return this.log("using component service",o),o}}return this.log("using global service",this.appService),this.appService}}]),e}(),ge=function(){function e(t){var n=t.serviceManager,r=t.log;U(this,e);var o=n.appService,i=n.buildService;console.log("Dragula constructor",{serviceManager:n,log:r}),this.appService=o,this.buildService=i,this.log=r.serviceConfig,this.options=o.options,this.$service={options:o.setOptions.bind(o),find:o.find.bind(o),eventBus:o.eventBus},this.$service.options("default",{}),this.createServices=this.createService}return $(e,[{key:"optionsFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.service(e).setOptions(t),this}},{key:"createService",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.log("!!! createService",e),this._serviceMap=this._serviceMap||{};var t=e.names||[],n=e.name||[],r=e.drakes||{},o=e.drake,i=Object.assign({},this.options,e);t=t.length>0?t:[n];var a=e.eventBus||this.appService.eventBus;a||console.warn("Eventbus could not be created",a),this.log("names",t);var s=!0,l=!1,c=void 0;try{for(var u,d=t[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value,v={name:h,eventBus:a,options:i};this.log("create DragulaService",h,v),this._serviceMap[h]=this.buildService(v),r.default||(r.default=o||!0),this.drakesFor(h,r)}}catch(e){l=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw c}}return this}},{key:"drakesFor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("drakesFor",e,t);var n=this.service(e);Array.isArray(t)&&(t=t.reduce(function(e,t){return e[t]=!0,e},{}));var r=Object.keys(t),o=!0,i=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var c=s.value,u=t[c];u===!0&&(u={}),n.setOptions(c,u)}}catch(e){i=!0,a=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw a}}return this}},{key:"on",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.log("on",e,t),i(e)){t=e;var n=this.serviceNames;if(!n||n.length<1)return console.warn("vue-dragula: No services found to add events handlers for",this._serviceMap),this;this.log("add event handlers for",n);var r=!0,o=!1,a=void 0;try{for(var s,l=n[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;this.on(c,t)}}catch(e){o=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}return this}var u=this.service(e);return u?(this.log("service.on",u,t),u.on(t),this):(console.warn("vue-dragula: no service "+e+" to add event handlers for"),this)}},{key:"service",value:function(e){if(this._serviceMap){var t=this._serviceMap[e];if(this.log("lookup service",e,t),!t){this.log("not found by name, get default");var n=this.serviceNames;n&&(t=this._serviceMap[n[0]])}return t}}},{key:"serviceNames",get:function(){return Object.keys(this._serviceMap)}},{key:"services",get:function(){return Object.values(this._serviceMap)}}]),e}(),fe=function(){function e(t){var n=t.serviceManager,r=t.name,o=t.log;U(this,e),this.serviceManager=n,this.globalName=r,this.log=o.dir}return $(e,[{key:"extractAll",value:function(e){var t=(e.container,e.vnode),n=e.ctx,r=s(this.globalName,t,n),o=r.name,i=r.drakeName,a=r.serviceName,l=this.serviceManager.findService(o,t,a),c=l.find(i,t);return l?{drake:c,service:l,name:o,drakeName:i,serviceName:a}:void this.log("no service found",o,i)}}]),e}(),me=function(e){function t(e){var n=e.serviceManager,r=e.name,o=e.log;U(this,t);var i=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{serviceManager:n,name:r,log:o}));return i.drakeContainers={},i.execute=i.update.bind(i),i}return Y(t,e),$(t,[{key:"update",value:function(e){var n=e.newValue,r=e.container,o=e.vnode,i=e.ctx;this.log("updateDirective");var a=X(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"extractAll",this).call(this,{vnode:o,ctx:i}),s=a.service,l=a.drake,c=a.drakeName,u=a.serviceName;this.drakeContainers[c]=this.drakeContainers[c]||[];var d=this.drakeContainers[c];l.models||(l.models=[]),o||(r=this.el),this.log("findModelContainer",r,l);var h=s.findModelContainer(r,l);d.push(r),this.log("DATA",{service:{name:u,instance:s},drake:{name:c,instance:l},container:r,modelContainer:h}),h?(this.log("set model of container",n),h.model=n):(this.log("push model and container on drake",n,r),l.models.push({model:n,container:r}))}}]),t}(fe),pe=function(e){function t(e){var n=e.serviceManager,r=e.name,o=e.log;U(this,t);var i=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{serviceManager:n,name:r,log:o}));return i.execute=i.bind.bind(i),i}return Y(t,e),$(t,[{key:"bind",value:function(e){var n=e.container,r=e.vnode,o=e.ctx,i=X(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"extractAll",this).call(this,{vnode:r,ctx:o}),a=i.service,s=i.drake,l=i.name,c=i.drakeName,u=i.serviceName;if(r||(n=this.el),this.log({service:{name:u,instance:a},drake:{name:c,instance:s},container:n}),s)return void s.containers.push(n);var d=L({containers:[n]});a.add(l,d),a.handleModels(l,d)}}]),t}(fe),ye=function(e){function t(e){var n=e.serviceManager,r=e.name,o=e.log;U(this,t);var i=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{serviceManager:n,name:r,log:o}));return i.execute=i.unbind.bind(i),i}return Y(t,e),$(t,[{key:"unbind",value:function(e){var n=e.container,r=(e.binding,e.vnode),o=e.ctx,i=X(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"extractAll",this).call(this,{vnode:r,ctx:o}),a=i.service,s=i.drake,l=i.name,c=i.drakeName,u=i.serviceName;if(this.log({service:{name:u,instance:a},drake:{name:c,instance:s},container:n}),s){var d=s.containers.indexOf(n);d>-1&&(this.log("remove container",d),s.containers.splice(d,1)),0===s.containers.length&&(this.log("destroy service"),a.destroy(l))}}}]),t}(fe),Me=function(){function e(t){var n=t.Vue,r=t.serviceManager,o=t.name,i=void 0===o?"globalDrake":o,a=t.options,s=t.log;U(this,e),console.log("Creator",r,a),this.name=i,this.Vue=n,this.log=s.dir,this.options=a,this.execute=this.create.bind(this),this.default={args:{serviceManager:r,name:i,log:s},updater:me,binder:pe,unbinder:ye},this.updater=this.createDirClass("updater",a),this.binder=this.createDirClass("binder",a),this.unbinder=this.createDirClass("unbinder",a)}return $(e,[{key:"createDirClass",value:function(e,t){var n=this;console.log("createDirClass",e,t);var r=this.default[e],o=function(){return new r(n.default.args)},i="create"+l(e),a=this.options.directive?this.options.directive[i]:null,s=a||o;return s(this.default.args)}},{key:"updateDirective",value:function(e){var t=e.container,n=e.binding,r=e.vnode,o=e.oldVnode,i=e.ctx,a=r?n.value:t;a&&this.updater.execute({container:t,vnode:r,binding:n,newValue:a,oldVnode:o,ctx:i})}},{key:"create",value:function(){var e=this;this.Vue.directive("dragula",{params:["drake","service"],bind:function(t,n,r){e.log("BIND",t,n,r),e.binder.execute({container:t,binding:n,vnode:r,ctx:e})},update:function(t,n,r,o){e.log("UPDATE",t,n,r),1===e.Vue.version&&e.updateDirective({container:t,binding:n,vnode:r,oldVnode:o,ctx:e})},componentUpdated:function(t,n,r,o){e.log("COMPONENT UPDATED",t,n,r)},inserted:function(t,n,r,o){e.log("INSERTED",t,n,r),e.updateDirective({container:t,binding:n,vnode:r,oldVnode:o,ctx:e})},unbind:function(t,n,r){e.log("UNBIND",t,n,r),e.unbinder.execute({container:t,binding:n,vnode:r,ctx:e})}})}}]),e}(),ke=function(){function e(t){U(this,e),console.log("Logger",t),this.options=t,this.logging=t.logging||t}return $(e,[{key:"plugin",value:function(){var e;if(this.logging&&this.logging.plugin){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["vue-dragula plugin"].concat(n))}}},{key:"serviceConfig",value:function(){var e;if(this.logging&&this.logging.service){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["vue-dragula service config: "].concat(n))}}},{key:"dir",value:function(){var e;if(this.logging&&this.logging.directive){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["v-dragula directive"].concat(n))}}}]),e}(),be={createEventBus:function(e){return new e},createServiceManager:function(e){var t=e.Vue,n=e.options,r=e.log;return new ve({Vue:t,options:n,log:r})},createLogger:function(e){return new ke(e)},createDragula:function(e){var t=e.serviceManager,n=e.log;return new ge({serviceManager:t,log:n})},createCreator:function(e){var t=e.Vue,n=e.serviceManager,r=e.options,o=e.log;return new Me({Vue:t,serviceManager:n,options:r,log:o})}};if(!L)throw new Error("[vue-dragula] cannot locate dragula.");var xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,e),this.name=t.name||"default",this.logging=t.logging,this.observer={undo:function(e){},redo:function(e){}},this.actions={done:[],undone:[]}}return $(e,[{key:"log",value:function(e){var t;if(this.shouldLog){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,[this.clazzName+" ["+this.name+"] :",e].concat(r))}}},{key:"clear",value:function(){this.actions.done=[],this.actions.undone=[]}},{key:"doAct",value:function(e,t){var n=e[t].bind(e);if(!n)throw new Error(e,"missing",t,"method");n()}},{key:"do",value:function(e){var t=e.name,n=e.container,r=n.do,o=n.undo;if(r.length){var i=r.pop(),a=i.models;this.log(t,i);var s=a.source,l=a.target;this.doAct(s,t),this.doAct(l,t),this.emitAction(t,i),o.push(i)}}},{key:"emitAction",value:function(e,t){var n=this.observer[e];"function"==typeof n&&n(t)}},{key:"onUndo",value:function(e){this.observer.undo=e}},{key:"onRedo",value:function(e){this.observer.redo=e}},{key:"undo",value:function(){this.do({name:"undo",container:{do:this.actions.done,undo:this.actions.undone}})}},{key:"redo",value:function(){this.do({name:"redo",container:{do:this.actions.undone,undo:this.actions.done}})}},{key:"act",value:function(e){var t=(e.name,e.models),n=e.indexes,r=e.elements;this.actions.done.push({models:t,indexes:n,elements:r})}},{key:"clazzName",get:function(){return this.constructor.name||"ActionManager"}},{key:"shouldLog",get:function(){return this.logging}}]),e}(),we={removeAt:function(e){e.indexes,e.containers},insertGroupOf:function(e){return e.id},setGroup:function(e,t){e[this.groupProp]=t},insertAt:function(e){var t=e.indexes,n=e.models,r=e.containers,o=t.drop,i=n.transit;this.log("insertAt",{model:this.model,index:o,dropModel:i});var a=this.model.slice(0,o),s=this.model.slice(o),l=this.insertGroupOf(r.target);this.setGroup(i,l);var c=this.createModel().concat(a,i,s);return this.actionUpdateModel(c),c}},Ee=he.createTimeMachine,Oe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,t);var n=G(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.timeOut=e.timeOut||800;var r=e.createTimeMachine||Ee;return n.timeMachine=r(Object.assign(e,{model:n.model,modelRef:n.modelRef})),n}return Y(t,e),$(t,[{key:"timeTravel",value:function(e){return this.timeMachine.timeTravel(e)}},{key:"undo",value:function(){return this.timeMachine.undo(),this}},{key:"redo",value:function(){return this.timeMachine.redo(),this}},{key:"addToHistory",value:function(e){return this.timeMachine.addToHistory(e),this}},{key:"createModel",value:function(e){return e||[]}},{key:"createFor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new t(e)}},{key:"at",value:function(e){return console.log("find model at",e,this.model),X(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"at",this).call(this,e)}},{key:"isEmpty",value:function(){return 0===this.model.length}},{key:"actionUpdateModel",value:function(e){var t=this;setTimeout(function(){t.addToHistory(e)},this.timeOut||800)}},{key:"removeAt",value:function(e){var t=e.indexes,n=t.drag;this.log("removeAt",{model:this.model,index:n});var r=this.model.slice(0,n),o=this.model.slice(n+1);this.log("removeAt: concat",r,o);var i=this.createModel().concat(r,o);return this.actionUpdateModel(i),i}},{key:"insertAt",value:function(e){var t=e.indexes,n=e.models,r=t.drop,o=n.transit;this.log("insertAt",{model:this.model,index:r,dropModel:o});var i=this.model.slice(0,r),a=this.model.slice(r);this.log("insertAt: concat",i,o,a);var s=this.createModel().concat(i,o,a);return this.actionUpdateModel(s),s}},{key:"move",value:function(e){var t=e.indexes;return this.log("move",{model:this.model,indexes:t}),this.timeMachine.undo(),this}},{key:"clazzName",get:function(){return this.constructor.name||"ImmutableModelManager"}},{key:"model",get:function(){return this.timeMachine?this.timeMachine.model:this._model}},{key:"history",get:function(){return this.timeMachine.history}},{key:"timeIndex",get:function(){return this.timeMachine.timeIndex}},{key:"first",get:function(){return this.at(0)}},{key:"last",get:function(){return this.at(this.model.length-1)}}]),t}(J);u.version="3.0.0";var _e=u,De={service:se,directive:be,commonDefaults:he};"function"==typeof define&&define.amd?define([],function(){}):window.Vue&&window.Vue.use(u),e.Vue2Dragula=_e,e.defaults=De,e.ActionManager=xe,e.VueDragula=c,e.Dragula=ge,e.Logger=ke,e.ServiceManager=ve,e.Updater=me,e.Base=fe,e.Binder=pe,e.UnBinder=ye,e.Creator=Me,e.DragulaService=ue,e.DragHandler=ae,e.DragulaEventHandler=ee,e.ModelHandler=ie,e.GroupOps=we,e.ModelManager=J,e.ImmutableModelManager=Oe,e.TimeMachine=de});